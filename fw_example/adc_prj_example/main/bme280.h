/*
	Name:			bme280.h
	Purpose:		IO module
	Author:			www.open-plc.com
	Created:		2018/07
	Modified by:	2019/09
	RCS-ID:
	Copyright:		(c) Open-PLC
	Licence:		The MIT License (MIT)
*/


#ifndef _BME280_LIB_H_
#define _BME280_LIB_H_

#define BME280_addr 0xED
//#define BME280_addr 0xEF
//#define DT 0
#define DT 3520
//#define DT 1020
#define I2C2_TIMEOUT 200000

#define BME280_REG_CONTROL 0xF4
#define BME280_REG_CONFIG 0xF5
#define BME280_REG_CTRL_HUM 0xF2

#define BME280_REG_RESULT_PRESSURE 0xF7			// 0xF7(msb) , 0xF8(lsb) , 0xF9(xlsb) : stores the pressure data.
#define BME280_REG_RESULT_TEMPRERATURE 0xFA		// 0xFA(msb) , 0xFB(lsb) , 0xFC(xlsb) : stores the temperature data.
#define BME280_REG_RESULT_HUMIDDATA 0xFD

#define BME280_OVERSAMPLING_T1		0x20
#define BME280_OVERSAMPLING_T2		0x40
#define BME280_OVERSAMPLING_T4		0x60
#define BME280_OVERSAMPLING_T8		0x80
#define BME280_OVERSAMPLING_T16		0xA0

#define BME280_OVERSAMPLING_H1		0x01
#define BME280_OVERSAMPLING_H2		0x02
#define BME280_OVERSAMPLING_H4		0x03
#define BME280_OVERSAMPLING_H8		0x04
#define BME280_OVERSAMPLING_H16		0x05

#define BME280_OVERSAMPLING_P1		0x04
#define BME280_OVERSAMPLING_P2		0x08
#define BME280_OVERSAMPLING_P4		0x0C
#define BME280_OVERSAMPLING_P8		0x10
#define BME280_OVERSAMPLING_P16		0x14

#define BME280_MODE_SLEEP			0x00
#define BME280_MODE_FORCED			0x01
#define BME280_MODE_NORMAL			0x03

#define BME280_TSB_0_5				0x00
#define BME280_TSB_62_5				0x20
#define BME280_TSB_125				0x40
#define BME280_TSB_250				0x60
#define BME280_TSB_500				0x80
#define BME280_TSB_1000				0xA0
#define BME280_TSB_2000				0xC0
#define BME280_TSB_4000				0xE0

#define BME280_FILTER_OFF			0x00
#define BME280_FILTER_COEFFICIENT2	0x04
#define BME280_FILTER_COEFFICIENT4	0x08
#define BME280_FILTER_COEFFICIENT8	0x0C
#define BME280_FILTER_COEFFICIENT16	0x10

#define BME280_SPI_OFF				0x00
#define BME280_SPI_ON				0x01

#define BME280_CONFIG		( BME280_TSB_125 | BME280_FILTER_COEFFICIENT16 | BME280_SPI_OFF )
#define BME280_CONFIG_HUM	( BME280_OVERSAMPLING_H4 )
#define BME280_MEAS			( BME280_OVERSAMPLING_T4 | BME280_OVERSAMPLING_P4 | BME280_MODE_NORMAL )

void BME280_Init( void );
void bme280Convert( int32_t *temperature, int32_t *pressure, int32_t *humidity );

#endif	// _BME280_LIB_H_
